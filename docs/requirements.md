# ギターコードクイズWebアプリ 要件定義

## 概要
フレットボード上の押弦位置からコード名を当てるクイズWebアプリケーション

## 基本機能

### 1. フレットボード表示
- 視覚的なギターネックの表示（6弦×12フレット程度）
- 各フレットと弦の明確な区分線
- フレット番号の表示

### 2. 押弦位置表示
- ドットまたはマーカーでフレット位置を表示
- 押弦している指の位置を視覚的に識別可能
- クリアで見やすいデザイン

### 3. コード入力機能
- プルダウンメニューまたは入力フィールド
- 一般的なコード名の候補表示
- 入力補完機能

### 4. 正解判定機能
- 即座のフィードバック表示
- 正解・不正解の明確な表示
- 正解時のコード名表示

## 追加機能

### 5. 難易度選択
- **初級**: 基本コード（C, G, Am, F等）
- **中級**: バレーコード（F, Bm等）
- **上級**: 複雑なコード（add9, sus4, dim等）

### 6. スコア機能
- 連続正解数の記録
- 正答率の計算・表示
- セッション統計の保存

### 7. ヒント機能
- ルート音の表示
- コードタイプのヒント（メジャー/マイナー等）
- 段階的ヒント表示

### 8. 練習モード
- 特定のコードファミリーに絞った練習
  - メジャーコードのみ
  - マイナーコードのみ
  - 7thコードのみ
- カスタム練習セット作成

### 9. 音再生機能
- 正解コードの音を再生
- Web Audio APIを使用した音源生成
- 音量調整機能

### 10. カポタスト対応機能
- カポ位置設定（1-12フレット）
- カポありでのコード表示
- 実音とカポ位置での表記の切り替え

## 技術要件

### クライアントサイド構成
- **Next.js 14+ (Static Export)** 完全静的サイト生成
- **TypeScript** 型安全性確保
- **React 18+** Client Componentsのみ使用

### アーキテクチャ
```
src/
├── app/
│   ├── layout.tsx       # ルートレイアウト
│   ├── page.tsx         # ホームページ（メニュー）
│   └── globals.css      # グローバルスタイル
├── components/
│   ├── ui/              # 再利用可能UIコンポーネント
│   ├── fretboard/       # フレットボード描画・表示
│   ├── quiz/            # クイズ機能
│   └── practice/        # 練習モード
├── lib/
│   ├── chords.ts        # 静的コードデータ・ロジック
│   ├── audio.ts         # 音声生成ユーティリティ
│   ├── storage.ts       # LocalStorage管理
│   └── utils.ts         # 汎用ユーティリティ
├── hooks/
│   ├── useLocalStorage.ts  # ローカルストレージフック
│   ├── useAudio.ts         # 音声制御フック
│   └── useQuizState.ts     # クイズ状態管理フック
├── types/
│   └── index.ts         # TypeScript型定義
└── data/
    └── chord-patterns.ts   # 静的コードパターンデータ
```

### スタイリング
- **Tailwind CSS** ユーティリティファーストCSS
- **clsx** 条件付きクラス名結合
- **CSS Variables** ダークモード・テーマ対応

### UI コンポーネント
- **純粋なReactコンポーネント** 軽量化重視
- **CSS Animations** スムーズなフィードバック
- **ネイティブHTML要素** アクセシビリティ確保

### 状態管理
- **React useState/useReducer** ローカル状態管理
- **Context API** 設定・テーマの共有（最小限）
- **カスタムフック** 状態ロジックの再利用

### フレットボード描画
- **SVG** スケーラブル・レスポンシブ対応
- **React SVG Elements** 宣言的描画
- **CSS Transitions** インタラクション時のアニメーション

### 音声機能
- **Web Audio API** 直接利用（軽量化）
- **Oscillator Nodes** 基本波形生成
- **Audio Context** 低レイテンシー再生

### データ管理
- **LocalStorage** スコア・設定の永続化
- **Session Storage** 一時的なクイズ状態
- **Static JSON** コードパターンデータ
- **TypeScript型ガード** データ検証

### パフォーマンス最適化
- **Static Generation** `next export`による静的サイト
- **React.memo** 不要な再レンダリング防止
- **useMemo/useCallback** 計算結果キャッシュ
- **Lazy Loading** 音声データの遅延読み込み

### 開発・品質管理
- **ESLint + Prettier** コード品質・フォーマット
- **TypeScript Strict Mode** 厳密な型チェック
- **React Testing Library** コンポーネントテスト

### 型定義例
```typescript
interface ChordPattern {
  name: string;
  frets: (number | null)[];
  fingers: (number | null)[];
  difficulty: 'beginner' | 'intermediate' | 'advanced';
}

interface QuizState {
  currentChord: ChordPattern;
  score: number;
  streak: number;
  timeElapsed: number;
}
```

### デプロイ・ホスティング
- **Static Export** `next export`による静的ファイル生成
- **GitHub Pages** 無料静的ホスティング
- **Netlify/Vercel** 静的サイトホスティング
- **PWA対応** Service Workerによるオフライン機能

### ビルド構成
```json
// next.config.js
{
  "output": "export",
  "distDir": "dist",
  "trailingSlash": true,
  "images": {
    "unoptimized": true
  }
}
```

## UI・UX設計

### レスポンシブレイアウト
- **モバイルファースト** デザインアプローチ
- **ブレークポイント**: 
  - Mobile: ~768px（縦持ち中心）
  - Tablet: 768px~1024px（縦・横両対応）
  - Desktop: 1024px~（横持ち中心）

### 画面構成

#### モバイル（縦画面）
```
┌─────────────────┐
│     Header      │
├─────────────────┤
│                 │
│   Fretboard     │
│   (縦長表示)     │
│                 │
├─────────────────┤
│  Answer Input   │
├─────────────────┤
│ Score | Hints   │
└─────────────────┘
```

#### デスクトップ（横画面）
```
┌──────────────────────────────┐
│           Header             │
├─────────────────┬────────────┤
│                 │  Answer    │
│   Fretboard     │  Input     │
│   (横長表示)     │            │
│                 ├────────────┤
│                 │   Score    │
│                 │   Hints    │
└─────────────────┴────────────┘
```

### フレットボード適応表示
- **モバイル**: 縦向き配置、フレット4-5個表示
- **タブレット**: 横向き配置、フレット8-10個表示  
- **デスクトップ**: 横向き配置、フレット12個表示
- **自動スケーリング**: 画面サイズに応じた適切なサイズ調整

### タッチ・クリック操作対応
- **大きなタッチターゲット**: 最小44px×44px
- **ホバー効果**: デスクトップでのマウスオーバー表示
- **タップフィードバック**: モバイルでの触覚フィードバック

### 入力方式の最適化
- **モバイル**: 
  - 大きなボタン型選択肢
  - スワイプによるヒント表示
  - 画面キーボード対応
- **デスクトップ**: 
  - キーボードショートカット対応
  - ドロップダウン選択
  - ホバーヒント表示

### パフォーマンス配慮
- **画像最適化**: WebP対応、適切なサイズ配信
- **タッチ遅延**: 300ms遅延回避
- **スムーズスクロール**: 60fps維持

## ユーザビリティ
- **直感的な操作性**: プラットフォーム固有の操作パターン
- **明確なフィードバック**: 視覚・音声・触覚フィードバック
- **アクセシビリティ対応**: WCAG 2.1 AA準拠
- **オフライン対応**: PWA機能による圏外利用可能

## フレットボードUIデザイン仕様（確定版）

### 基準レイアウト
`sample/fretboard-design-sample.html`を実装基準とする

### フレットボード表示仕様
1. **横向きフレットボードのみ採用**
   - 縦向きフレットボードは実装しない
   - 全てのデバイスで横向きレイアウトを使用

2. **SVG描画仕様**
   - **viewBox**: `0 0 800 300`
   - **アスペクト比**: 8:3（横長）
   - **レスポンシブ**: `w-full h-auto`で画面幅に対応

3. **弦配置（必須）**
   - **弦順序**: 上から1弦（高音E）、下が6弦（低音E）
   - **弦間隔**: 40px
   - **弦の太さ**: 高音弦（1-4弦）`stroke-width="1"`、低音弦（5-6弦）`stroke-width="1.5"`

4. **フレット配置**
   - **フレット数**: 0-5フレット表示
   - **フレット間隔**: 120px
   - **ナット**: `stroke-width="4"`、他フレット`stroke-width="2"`

5. **弦名目盛り（必須要素）**
   - **位置**: SVG左側（x="30"）
   - **内容**: E,B,G,D,A,E（上から順）
   - **弦番号**: 更に左側（x="15"）に1,2,3,4,5,6を小さく表示
   - **スタイル**: `font-semibold text-gray-700`

6. **フレット番号表示**
   - **位置**: SVG上部（y="30"）
   - **内容**: 1,2,3,4,5
   - **スタイル**: `text-xs font-medium text-gray-600`

7. **ポジションマーク**
   - **3フレット**: (320, 160)
   - **5フレット**: (560, 160)
   - **スタイル**: `r="4" fill="#E5E7EB"`

### 押弦位置表示仕様
1. **押弦ドット**
   - **サイズ**: `r="14"`
   - **色**: `fill="#3B82F6"`（青）
   - **枠線**: `stroke="#FFFFFF" stroke-width="3"`

2. **インタラクション効果**
   - **hover/focus**: `stroke-width: 4px` + `drop-shadow` + 色変更
   - **位置固定**: `transform: scale`は使用禁止
   - **アクセシビリティ**: フォーカス時のアウトライン表示

3. **指番号表示**
   - **位置**: 押弦ドット中央
   - **スタイル**: `fill-white text-sm font-semibold`
   - **表示条件**: `showFingers={true}`時のみ

### 削除する要素
1. **フレットボード下の弦名表示**: E,B,G,D,A,Eのグリッド表示は不要
2. **縦向きフレットボード**: モバイル向け縦表示は実装しない
3. **複数レイアウト**: 横向き統一レイアウトのみ

### アクセシビリティ要件
1. **キーボード操作**
   - Tab/Shift+Tabでフォーカス移動
   - Enter/Spaceで音声再生
   - 矢印キーでフレットボード内移動

2. **スクリーンリーダー対応**
   - 適切なaria-label設定
   - role="button"でインタラクティブ要素を明示

3. **視覚的配慮**
   - WCAG 2.1 AAA準拠のコントラスト比
   - 44px最小タッチターゲット確保
   - 高コントラストモード対応